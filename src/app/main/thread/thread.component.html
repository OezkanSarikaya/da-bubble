<section class="thread" [ngClass]="{ 'ThreadOpen': isVisible, 'ThreadClosed': !isVisible }">
  <div class="threadName">
    <div>
      <h3>Thread</h3>
      <span># {{channelObserved()?.name}}</span>
    </div>


    <svg (click)="hide()" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <mask id="mask0_79092_694" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">
      <rect width="24" height="24" fill="#D9D9D9"/>
      </mask>
      <g mask="url(#mask0_79092_694)">
      <path d="M12 13.4L7.10005 18.3C6.91672 18.4833 6.68338 18.575 6.40005 18.575C6.11672 18.575 5.88338 18.4833 5.70005 18.3C5.51672 18.1167 5.42505 17.8833 5.42505 17.6C5.42505 17.3167 5.51672 17.0833 5.70005 16.9L10.6 12L5.70005 7.09999C5.51672 6.91665 5.42505 6.68332 5.42505 6.39999C5.42505 6.11665 5.51672 5.88332 5.70005 5.69999C5.88338 5.51665 6.11672 5.42499 6.40005 5.42499C6.68338 5.42499 6.91672 5.51665 7.10005 5.69999L12 10.6L16.9 5.69999C17.0834 5.51665 17.3167 5.42499 17.6 5.42499C17.8834 5.42499 18.1167 5.51665 18.3 5.69999C18.4834 5.88332 18.575 6.11665 18.575 6.39999C18.575 6.68332 18.4834 6.91665 18.3 7.09999L13.4 12L18.3 16.9C18.4834 17.0833 18.575 17.3167 18.575 17.6C18.575 17.8833 18.4834 18.1167 18.3 18.3C18.1167 18.4833 17.8834 18.575 17.6 18.575C17.3167 18.575 17.0834 18.4833 16.9 18.3L12 13.4Z" fill="black"/>
      </g>
      </svg>
  </div>

  <div class="threadBody">
      @if(threadObserved()?.senderID !== currentUser.idFirebase){
        <div class="chatMessage leftMessage">
          <div class="addReaction leftPopup">  
            <span class="moreIcons">
              <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <mask
                id="mask0_79092_10289"
                style="mask-type: alpha"
                maskUnits="userSpaceOnUse"
                x="0"
                y="0"
                width="24"
                height="24"
              >
                <rect width="24" height="24" fill="#D9D9D9" />
              </mask>
              <g mask="url(#mask0_79092_10289)">
                <path
                  d="M12 22C10.6167 22 9.31667 21.7375 8.1 21.2125C6.88333 20.6875 5.825 19.975 4.925 19.075C4.025 18.175 3.3125 17.1167 2.7875 15.9C2.2625 14.6833 2 13.3833 2 12C2 10.6167 2.2625 9.31667 2.7875 8.1C3.3125 6.88333 4.025 5.825 4.925 4.925C5.825 4.025 6.88333 3.3125 8.1 2.7875C9.31667 2.2625 10.6167 2 12 2C12.75 2 13.4792 2.07917 14.1875 2.2375C14.8958 2.39583 15.5667 2.625 16.2 2.925C16.1333 3.09167 16.0833 3.26667 16.05 3.45C16.0167 3.63333 16 3.81667 16 4C16 4.23333 16.025 4.45417 16.075 4.6625C16.125 4.87083 16.1917 5.06667 16.275 5.25C15.6583 4.86667 14.9917 4.5625 14.275 4.3375C13.5583 4.1125 12.8 4 12 4C9.78333 4 7.89583 4.77917 6.3375 6.3375C4.77917 7.89583 4 9.78333 4 12C4 14.2167 4.77917 16.1042 6.3375 17.6625C7.89583 19.2208 9.78333 20 12 20C14.2167 20 16.1042 19.2208 17.6625 17.6625C19.2208 16.1042 20 14.2167 20 12C20 11.3333 19.9208 10.6917 19.7625 10.075C19.6042 9.45833 19.3833 8.875 19.1 8.325C19.3667 8.54167 19.6583 8.70833 19.975 8.825C20.2917 8.94167 20.6333 9 21 9C21.0833 9 21.1708 8.99583 21.2625 8.9875C21.3542 8.97917 21.4417 8.96667 21.525 8.95C21.675 9.43333 21.7917 9.92917 21.875 10.4375C21.9583 10.9458 22 11.4667 22 12C22 13.3833 21.7375 14.6833 21.2125 15.9C20.6875 17.1167 19.975 18.175 19.075 19.075C18.175 19.975 17.1167 20.6875 15.9 21.2125C14.6833 21.7375 13.3833 22 12 22ZM15.5 11C15.9333 11 16.2917 10.8583 16.575 10.575C16.8583 10.2917 17 9.93333 17 9.5C17 9.06667 16.8583 8.70833 16.575 8.425C16.2917 8.14167 15.9333 8 15.5 8C15.0667 8 14.7083 8.14167 14.425 8.425C14.1417 8.70833 14 9.06667 14 9.5C14 9.93333 14.1417 10.2917 14.425 10.575C14.7083 10.8583 15.0667 11 15.5 11ZM8.5 11C8.93333 11 9.29167 10.8583 9.575 10.575C9.85833 10.2917 10 9.93333 10 9.5C10 9.06667 9.85833 8.70833 9.575 8.425C9.29167 8.14167 8.93333 8 8.5 8C8.06667 8 7.70833 8.14167 7.425 8.425C7.14167 8.70833 7 9.06667 7 9.5C7 9.93333 7.14167 10.2917 7.425 10.575C7.70833 10.8583 8.06667 11 8.5 11ZM12 17.5C13.1833 17.5 14.2292 17.175 15.1375 16.525C16.0458 15.875 16.7 15.0333 17.1 14H6.9C7.3 15.0333 7.95417 15.875 8.8625 16.525C9.77083 17.175 10.8167 17.5 12 17.5ZM20 5H19C18.7167 5 18.4792 4.90417 18.2875 4.7125C18.0958 4.52083 18 4.28333 18 4C18 3.71667 18.0958 3.47917 18.2875 3.2875C18.4792 3.09583 18.7167 3 19 3H20V2C20 1.71667 20.0958 1.47917 20.2875 1.2875C20.4792 1.09583 20.7167 1 21 1C21.2833 1 21.5208 1.09583 21.7125 1.2875C21.9042 1.47917 22 1.71667 22 2V3H23C23.2833 3 23.5208 3.09583 23.7125 3.2875C23.9042 3.47917 24 3.71667 24 4C24 4.28333 23.9042 4.52083 23.7125 4.7125C23.5208 4.90417 23.2833 5 23 5H22V6C22 6.28333 21.9042 6.52083 21.7125 6.7125C21.5208 6.90417 21.2833 7 21 7C20.7167 7 20.4792 6.90417 20.2875 6.7125C20.0958 6.52083 20 6.28333 20 6V5Z"
                  fill="black"
                />
              </g>
            </svg>
            <div class="moreIconsPopup moreIconsPopupLeft">
              <div>
                <span>
                  <img src="../assets/img/checked.png" alt="" />
                </span>
                <span>
                  <img src="../assets/img/hands.png" alt="" />
                </span>
              </div>
              <div>
                <span>
                  <img src="../assets/img/rocket.png" alt="" />
                </span>
                <span>
                  <img src="../assets/img/smart.png" alt="" />
                </span>
              </div>
            </div>
            </span>            
         
          </div>
          <img
            class="userProfile70"
            src="{{threadObserved()?.senderData?.avatar}}"
            alt=""
          />
          <div class="chatMessageDetails">
            <header>
              <span class="userName">{{threadObserved()?.senderData?.fullName}}</span>
              <time class="time" datetime="">{{threadObserved()?.time}}</time>
            </header>
            <div class="messageText">{{threadObserved()?.content}}</div>
          </div>
        </div> 
      }@else {
        <div class="chatMessage rightMessage">
          <img
            class="userProfile70"
            src="{{threadObserved()?.senderData?.avatar}}"
            alt=""
          />
          <div class="chatMessageDetails">
            <header>
              <span class="userName">{{threadObserved()?.senderData?.fullName}}</span>
              <time class="time" datetime="">{{threadObserved()?.time}}</time>
            </header>
            <div class="messageText">{{threadObserved()?.content}}</div>
          </div>
        </div> 
      }

      <div class="countThread">
        <span> {{threadObserved()?.threadIDS?.length}} Antworten</span>
        <div class="horizontal-line"></div>
      </div>

      @if(threadObserved()?.senderID){
        @for (thread of threadObserved()?.threadData; track $index) {
          @if(thread.senderID !== currentUser.idFirebase){
            @if(currentDate === thread.createAtString){
              <div class="timeLine"><span>Heute</span></div>
            }@else{
              <div class="timeLine"><span>{{thread.createAtString}}</span></div>
            }
            <div class="chatMessage leftMessage">
              <div class="addReaction leftPopup">  
                <span class="moreIcons">
                  <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <mask
                    id="mask0_79092_10289"
                    style="mask-type: alpha"
                    maskUnits="userSpaceOnUse"
                    x="0"
                    y="0"
                    width="24"
                    height="24"
                  >
                    <rect width="24" height="24" fill="#D9D9D9" />
                  </mask>
                  <g mask="url(#mask0_79092_10289)">
                    <path
                      d="M12 22C10.6167 22 9.31667 21.7375 8.1 21.2125C6.88333 20.6875 5.825 19.975 4.925 19.075C4.025 18.175 3.3125 17.1167 2.7875 15.9C2.2625 14.6833 2 13.3833 2 12C2 10.6167 2.2625 9.31667 2.7875 8.1C3.3125 6.88333 4.025 5.825 4.925 4.925C5.825 4.025 6.88333 3.3125 8.1 2.7875C9.31667 2.2625 10.6167 2 12 2C12.75 2 13.4792 2.07917 14.1875 2.2375C14.8958 2.39583 15.5667 2.625 16.2 2.925C16.1333 3.09167 16.0833 3.26667 16.05 3.45C16.0167 3.63333 16 3.81667 16 4C16 4.23333 16.025 4.45417 16.075 4.6625C16.125 4.87083 16.1917 5.06667 16.275 5.25C15.6583 4.86667 14.9917 4.5625 14.275 4.3375C13.5583 4.1125 12.8 4 12 4C9.78333 4 7.89583 4.77917 6.3375 6.3375C4.77917 7.89583 4 9.78333 4 12C4 14.2167 4.77917 16.1042 6.3375 17.6625C7.89583 19.2208 9.78333 20 12 20C14.2167 20 16.1042 19.2208 17.6625 17.6625C19.2208 16.1042 20 14.2167 20 12C20 11.3333 19.9208 10.6917 19.7625 10.075C19.6042 9.45833 19.3833 8.875 19.1 8.325C19.3667 8.54167 19.6583 8.70833 19.975 8.825C20.2917 8.94167 20.6333 9 21 9C21.0833 9 21.1708 8.99583 21.2625 8.9875C21.3542 8.97917 21.4417 8.96667 21.525 8.95C21.675 9.43333 21.7917 9.92917 21.875 10.4375C21.9583 10.9458 22 11.4667 22 12C22 13.3833 21.7375 14.6833 21.2125 15.9C20.6875 17.1167 19.975 18.175 19.075 19.075C18.175 19.975 17.1167 20.6875 15.9 21.2125C14.6833 21.7375 13.3833 22 12 22ZM15.5 11C15.9333 11 16.2917 10.8583 16.575 10.575C16.8583 10.2917 17 9.93333 17 9.5C17 9.06667 16.8583 8.70833 16.575 8.425C16.2917 8.14167 15.9333 8 15.5 8C15.0667 8 14.7083 8.14167 14.425 8.425C14.1417 8.70833 14 9.06667 14 9.5C14 9.93333 14.1417 10.2917 14.425 10.575C14.7083 10.8583 15.0667 11 15.5 11ZM8.5 11C8.93333 11 9.29167 10.8583 9.575 10.575C9.85833 10.2917 10 9.93333 10 9.5C10 9.06667 9.85833 8.70833 9.575 8.425C9.29167 8.14167 8.93333 8 8.5 8C8.06667 8 7.70833 8.14167 7.425 8.425C7.14167 8.70833 7 9.06667 7 9.5C7 9.93333 7.14167 10.2917 7.425 10.575C7.70833 10.8583 8.06667 11 8.5 11ZM12 17.5C13.1833 17.5 14.2292 17.175 15.1375 16.525C16.0458 15.875 16.7 15.0333 17.1 14H6.9C7.3 15.0333 7.95417 15.875 8.8625 16.525C9.77083 17.175 10.8167 17.5 12 17.5ZM20 5H19C18.7167 5 18.4792 4.90417 18.2875 4.7125C18.0958 4.52083 18 4.28333 18 4C18 3.71667 18.0958 3.47917 18.2875 3.2875C18.4792 3.09583 18.7167 3 19 3H20V2C20 1.71667 20.0958 1.47917 20.2875 1.2875C20.4792 1.09583 20.7167 1 21 1C21.2833 1 21.5208 1.09583 21.7125 1.2875C21.9042 1.47917 22 1.71667 22 2V3H23C23.2833 3 23.5208 3.09583 23.7125 3.2875C23.9042 3.47917 24 3.71667 24 4C24 4.28333 23.9042 4.52083 23.7125 4.7125C23.5208 4.90417 23.2833 5 23 5H22V6C22 6.28333 21.9042 6.52083 21.7125 6.7125C21.5208 6.90417 21.2833 7 21 7C20.7167 7 20.4792 6.90417 20.2875 6.7125C20.0958 6.52083 20 6.28333 20 6V5Z"
                      fill="black"
                    />
                  </g>
                </svg>
                <div class="moreIconsPopup moreIconsPopupLeft">
                  <div>
                    <span>
                      <img src="../assets/img/checked.png" alt="" />
                    </span>
                    <span>
                      <img src="../assets/img/hands.png" alt="" />
                    </span>
                  </div>
                  <div>
                    <span>
                      <img src="../assets/img/rocket.png" alt="" />
                    </span>
                    <span>
                      <img src="../assets/img/smart.png" alt="" />
                    </span>
                  </div>
                </div>
                </span>            
             
              </div>
              <img
                class="userProfile70"
                src="{{thread.senderData?.avatar}}"
                alt=""
              />
              <div class="chatMessageDetails">
                <header>
                  <span class="userName">{{thread.senderData?.fullName}}</span>
                  <time class="time" datetime="">{{thread.time}}</time>
                </header>
                <div class="messageText">{{thread.content}}</div>
                <app-show-reactions [reactions]="thread.reactions"></app-show-reactions>
              </div>
            </div> 
          }@else {
            @if(currentDate === thread.createAtString){
              <div class="timeLine"><span>Heute</span></div>
            }@else{
              <div class="timeLine"><span>{{thread.createAtString}}</span></div>
            }
            <div class="chatMessage rightMessage">
              <div class="addReaction rightPopup">  
                <span class="moreIcons">
                  <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <mask
                    id="mask0_79092_10289"
                    style="mask-type: alpha"
                    maskUnits="userSpaceOnUse"
                    x="0"
                    y="0"
                    width="24"
                    height="24"
                  >
                    <rect width="24" height="24" fill="#D9D9D9" />
                  </mask>
                  <g mask="url(#mask0_79092_10289)">
                    <path
                      d="M12 22C10.6167 22 9.31667 21.7375 8.1 21.2125C6.88333 20.6875 5.825 19.975 4.925 19.075C4.025 18.175 3.3125 17.1167 2.7875 15.9C2.2625 14.6833 2 13.3833 2 12C2 10.6167 2.2625 9.31667 2.7875 8.1C3.3125 6.88333 4.025 5.825 4.925 4.925C5.825 4.025 6.88333 3.3125 8.1 2.7875C9.31667 2.2625 10.6167 2 12 2C12.75 2 13.4792 2.07917 14.1875 2.2375C14.8958 2.39583 15.5667 2.625 16.2 2.925C16.1333 3.09167 16.0833 3.26667 16.05 3.45C16.0167 3.63333 16 3.81667 16 4C16 4.23333 16.025 4.45417 16.075 4.6625C16.125 4.87083 16.1917 5.06667 16.275 5.25C15.6583 4.86667 14.9917 4.5625 14.275 4.3375C13.5583 4.1125 12.8 4 12 4C9.78333 4 7.89583 4.77917 6.3375 6.3375C4.77917 7.89583 4 9.78333 4 12C4 14.2167 4.77917 16.1042 6.3375 17.6625C7.89583 19.2208 9.78333 20 12 20C14.2167 20 16.1042 19.2208 17.6625 17.6625C19.2208 16.1042 20 14.2167 20 12C20 11.3333 19.9208 10.6917 19.7625 10.075C19.6042 9.45833 19.3833 8.875 19.1 8.325C19.3667 8.54167 19.6583 8.70833 19.975 8.825C20.2917 8.94167 20.6333 9 21 9C21.0833 9 21.1708 8.99583 21.2625 8.9875C21.3542 8.97917 21.4417 8.96667 21.525 8.95C21.675 9.43333 21.7917 9.92917 21.875 10.4375C21.9583 10.9458 22 11.4667 22 12C22 13.3833 21.7375 14.6833 21.2125 15.9C20.6875 17.1167 19.975 18.175 19.075 19.075C18.175 19.975 17.1167 20.6875 15.9 21.2125C14.6833 21.7375 13.3833 22 12 22ZM15.5 11C15.9333 11 16.2917 10.8583 16.575 10.575C16.8583 10.2917 17 9.93333 17 9.5C17 9.06667 16.8583 8.70833 16.575 8.425C16.2917 8.14167 15.9333 8 15.5 8C15.0667 8 14.7083 8.14167 14.425 8.425C14.1417 8.70833 14 9.06667 14 9.5C14 9.93333 14.1417 10.2917 14.425 10.575C14.7083 10.8583 15.0667 11 15.5 11ZM8.5 11C8.93333 11 9.29167 10.8583 9.575 10.575C9.85833 10.2917 10 9.93333 10 9.5C10 9.06667 9.85833 8.70833 9.575 8.425C9.29167 8.14167 8.93333 8 8.5 8C8.06667 8 7.70833 8.14167 7.425 8.425C7.14167 8.70833 7 9.06667 7 9.5C7 9.93333 7.14167 10.2917 7.425 10.575C7.70833 10.8583 8.06667 11 8.5 11ZM12 17.5C13.1833 17.5 14.2292 17.175 15.1375 16.525C16.0458 15.875 16.7 15.0333 17.1 14H6.9C7.3 15.0333 7.95417 15.875 8.8625 16.525C9.77083 17.175 10.8167 17.5 12 17.5ZM20 5H19C18.7167 5 18.4792 4.90417 18.2875 4.7125C18.0958 4.52083 18 4.28333 18 4C18 3.71667 18.0958 3.47917 18.2875 3.2875C18.4792 3.09583 18.7167 3 19 3H20V2C20 1.71667 20.0958 1.47917 20.2875 1.2875C20.4792 1.09583 20.7167 1 21 1C21.2833 1 21.5208 1.09583 21.7125 1.2875C21.9042 1.47917 22 1.71667 22 2V3H23C23.2833 3 23.5208 3.09583 23.7125 3.2875C23.9042 3.47917 24 3.71667 24 4C24 4.28333 23.9042 4.52083 23.7125 4.7125C23.5208 4.90417 23.2833 5 23 5H22V6C22 6.28333 21.9042 6.52083 21.7125 6.7125C21.5208 6.90417 21.2833 7 21 7C20.7167 7 20.4792 6.90417 20.2875 6.7125C20.0958 6.52083 20 6.28333 20 6V5Z"
                      fill="black"
                    />
                  </g>
                </svg>
                <div class="moreIconsPopup">
                  <div>
                    <span>
                      <img src="../assets/img/checked.png" alt="" />
                    </span>
                    <span>
                      <img src="../assets/img/hands.png" alt="" />
                    </span>
                  </div>
                  <div>
                    <span>
                      <img src="../assets/img/rocket.png" alt="" />
                    </span>
                    <span>
                      <img src="../assets/img/smart.png" alt="" />
                    </span>
                  </div>
                </div>
                </span>            
                <span class="editDeleteMsg">
                  <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <mask id="mask0_79092_16838" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="25" height="24">
                    <rect x="0.333252" width="24" height="24" fill="#D9D9D9"/>
                    </mask>
                    <g mask="url(#mask0_79092_16838)">
                    <path d="M12.3333 20C11.7833 20 11.3124 19.8042 10.9208 19.4125C10.5291 19.0208 10.3333 18.55 10.3333 18C10.3333 17.45 10.5291 16.9792 10.9208 16.5875C11.3124 16.1958 11.7833 16 12.3333 16C12.8833 16 13.3541 16.1958 13.7458 16.5875C14.1374 16.9792 14.3333 17.45 14.3333 18C14.3333 18.55 14.1374 19.0208 13.7458 19.4125C13.3541 19.8042 12.8833 20 12.3333 20ZM12.3333 14C11.7833 14 11.3124 13.8042 10.9208 13.4125C10.5291 13.0208 10.3333 12.55 10.3333 12C10.3333 11.45 10.5291 10.9792 10.9208 10.5875C11.3124 10.1958 11.7833 10 12.3333 10C12.8833 10 13.3541 10.1958 13.7458 10.5875C14.1374 10.9792 14.3333 11.45 14.3333 12C14.3333 12.55 14.1374 13.0208 13.7458 13.4125C13.3541 13.8042 12.8833 14 12.3333 14ZM12.3333 8C11.7833 8 11.3124 7.80417 10.9208 7.4125C10.5291 7.02083 10.3333 6.55 10.3333 6C10.3333 5.45 10.5291 4.97917 10.9208 4.5875C11.3124 4.19583 11.7833 4 12.3333 4C12.8833 4 13.3541 4.19583 13.7458 4.5875C14.1374 4.97917 14.3333 5.45 14.3333 6C14.3333 6.55 14.1374 7.02083 13.7458 7.4125C13.3541 7.80417 12.8833 8 12.3333 8Z" fill="#1C1B1F"/>
                    </g>
                    </svg>
                    <div class="msgText">
                      <p (click)="editMessageThread(thread.id)">Nachricht bearbeiten</p>
                      <p (click)="deleteMessage(thread.id, selectedThread()!.id)">Löschen</p>
                    </div>
                    
                </span>
              </div>
              <img
                class="userProfile70"
                src="{{thread.senderData?.avatar}}"
              />
              <div class="chatMessageDetails">
                <header>
                  <span class="userName">{{thread.senderData?.fullName}}</span>
                  <time class="time" datetime="">{{thread.time}}</time>
                </header>
                <div class="messageText">{{thread.content}}</div>
                <app-show-reactions [reactions]="thread.reactions"></app-show-reactions>
              </div>
            </div> 
          }
          
        }
      }
  </div>

  @if(this.channelDependenciesService.isUserMemberChannel(channelObserved()!, currentUser)){
    <app-chatmsgbox context="thread" [content]="contentThread" [nameChannel]="nameChannelSignal"></app-chatmsgbox>
  }
</section>
